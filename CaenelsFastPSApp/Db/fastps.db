
record (stringin, "$(P)$(R)Model")
{
    field(DESC, "Model")
    field(DTYP, "stream")
    field(INP,  "@fastps.proto getModel L0")
    field(PINI, "YES")
}

record (ai, "$(P)$(R)LimitMaxI")
{
    field(DESC, "High limit for Current")
    field(DTYP, "stream")
    field(EGU,  "A")
    field(INP,  "@fastps.proto getLimitCurrent($(P)$(R)) L0")
    field(PINI, "YES")
    field(FLNK, "$(P)$(R)LimitMaxIneg_")
}

record (calcout, "$(P)$(R)LimitMaxIneg_")
{
    field(DESC, "Low limit for Current")
    field(INPA, "$(P)$(R)LimitMaxI")
    field(CALC,  "A*(-1)")
    field(OUT,  "$(P)$(R)Current.LOPR")
    field(FLNK, "$(P)$(R)_OutCurr_max")
}

record (calcout, "$(P)$(R)_OutCurr_max")
{
    field(DESC, "High limit for OutputCurrent")
    field(INPA, "$(P)$(R)LimitMaxI")
    field(CALC,  "A")
    field(OUT,  "$(P)$(R)OutputCurrent.HOPR")
    field(FLNK, "$(P)$(R)_OutCurr_min")
}

record (calcout, "$(P)$(R)_OutCurr_min")
{
    field(DESC, "Low limit for OutputCurrent")
    field(INPA, "$(P)$(R)LimitMaxI")
    field(CALC,  "A*(-1)")
    field(OUT,  "$(P)$(R)OutputCurrent.LOPR")
}

record (ai, "$(P)$(R)LimitMaxV")
{
    field(DESC, "High limit for Voltage")
    field(DTYP, "stream")
    field(EGU,  "V")
    field(INP,  "@fastps.proto getLimitVoltage($(P)$(R)) L0")
    field(PINI, "YES")
    field(FLNK, "$(P)$(R)LimitMaxVneg_")
}

record (calcout, "$(P)$(R)LimitMaxVneg_")
{
    field(DESC, "Low limit for Voltage")
    field(INPA, "$(P)$(R)LimitMaxV")
    field(CALC,  "A*(-1)")
    field(OUT,  "$(P)$(R)Voltage.LOPR")
    field(FLNK, "$(P)$(R)_OutVolt_max")
}

record (calcout, "$(P)$(R)_OutVolt_max")
{
    field(DESC, "High limit for OutputVoltage")
    field(INPA, "$(P)$(R)LimitMaxV")
    field(CALC,  "A")
    field(OUT,  "$(P)$(R)OutputVoltage.HOPR")
    field(FLNK, "$(P)$(R)_OutVolt_min")
}

record (calcout, "$(P)$(R)_OutVolt_min")
{
    field(DESC, "Low limit for OutputVoltage")
    field(INPA, "$(P)$(R)LimitMaxV")
    field(CALC,  "A*(-1)")
    field(OUT,  "$(P)$(R)OutputVoltage.LOPR")
}


record (stringin, "$(P)$(R)Version")
{
    field(DESC, "Model")
    field(DTYP, "stream")
    field(INP,  "@fastps.proto getVersion L0")
    field(PINI, "YES")
}
################################################################################

record(mbbiDirect, "$(P)$(R)_EnableInit")
{
    field(DESC, "Initialization for Enable")
    field(PINI, "YES")
    field(INP,  "@fastps.proto getStatusLSB L0")
    field(FLNK, "$(P)$(R)_EnableInitCalc")
}

record(calcout, "$(P)$(R)_EnableInitCalc")
{
    field(DESC, "Initialization for Enable")
    field(INPA, "$(P)$(R)StatusLSB")
    field(CALC, "A & 0x1")
    field(OUT,  "$(P)$(R)Enable.VAL")
}

record(bo, "$(P)$(R)Enable")
{
    field(DESC, "Turn supply off/on")
    field(DTYP, "stream")
    field(OUT,  "@fastps.proto setEnable L0")
    field(ZNAM, "Off")
    field(ONAM, "On")
}

record(bo, "$(P)$(R)RegulationMode")
{
    field(DESC, "Selects between voltage/current reg")
    field(DTYP, "stream")
    field(OUT,  "@fastps.proto setRegulationMode L0")
    field(ZNAM, "V")
    field(ONAM, "I")
}

record(ao, "$(P)$(R)Voltage")
{
    field(DESC, "Voltage control (in V reg mode)")
    field(DTYP, "stream")
    field(EGU,  "V")
    field(OUT,  "@fastps.proto setVoltage L0")
    field(PREC, "5")
}

record(ao, "$(P)$(R)Current")
{
    field(DESC, "Current control (in V reg mode)")
    field(DTYP, "stream")
    field(EGU,  "A")
    field(OUT,  "@fastps.proto setCurrent L0")
    field(PREC, "5")
}

record(bo, "$(P)$(R)StatusReset")
{
    field(DESC, "Reset status register/clear faults")
    field(DTYP, "stream")
    field(OUT,  "@fastps.proto resetStatus L0")
}

################################################################################
record(bi, "$(P)$(R)ReadbackPoll_")
{
    field(DESC, "Head of readback chain")
    field(FLNK, "$(P)$(R)OutputVoltage")
    field(PINI, "YES")
    field(INP,  "0")
    field(SCAN, "1 second")
}

record(ai, "$(P)$(R)OutputVoltage")
{
    field(DESC, "Output voltage")
    field(DTYP, "stream")
    field(EGU,  "V")
    field(FLNK, "$(P)$(R)OutputCurrent")
    field(INP,  "@fastps.proto getOutputVoltage L0")
    field(PREC, "5")
}

record(ai, "$(P)$(R)OutputCurrent")
{
    field(DESC, "Output current")
    field(DTYP, "stream")
    field(EGU,  "A")
    field(FLNK, "$(P)$(R)GroundCurrent")
    field(INP,  "@fastps.proto getOutputCurrent L0")
    field(PREC, "5")
}

record(ai, "$(P)$(R)GroundCurrent")
{
    field(DESC, "Ground current")
    field(DTYP, "stream")
    field(EGU,  "A")
    field(FLNK, "$(P)$(R)DCLinkVoltage")
    field(INP,  "@fastps.proto getGroundCurrent L0")
    field(PREC, "3")
}

record(ai, "$(P)$(R)DCLinkVoltage")
{
    field(DESC, "DC Link voltage")
    field(DTYP, "stream")
    field(EGU,  "V")
    field(FLNK, "$(P)$(R)HeatsinkTemp")
    field(INP,  "@fastps.proto getDCLinkVoltage L0")
    field(PREC, "2")
}

record(ai, "$(P)$(R)HeatsinkTemp")
{
    field(DESC, "Heatsink temperature")
    field(DTYP, "stream")
    field(EGU,  "deg C")
    field(FLNK, "$(P)$(R)StatusMSB")
    field(INP,  "@fastps.proto getTemperature L0")
    field(PREC, "2")
}

record(mbbiDirect, "$(P)$(R)StatusMSB")
{
    field(DESC, "Status MSB")
    field(DTYP, "stream")
    field(FLNK, "$(P)$(R)StatusLSB")
    field(INP,  "@fastps.proto getStatusMSB L0")
}

record(mbbiDirect, "$(P)$(R)StatusLSB")
{
    field(DESC, "Status LSB")
    field(DTYP, "stream")
    field(INP,  "@fastps.proto getStatusLSB L0")
}
